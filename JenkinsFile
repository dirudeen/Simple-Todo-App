pipeline {
  //agent { dockerfile true }
  agent {
    docker {
      image: node:lts-alpine3.18
    }
  }
  environment {
      DOCKER_CREDS = credentials('Docker_Credentials')
    }

  stages {
      stage('Checkout') {
          steps {
            git url: 'https://github.com/dirudeen/Simple-Todo-App.git', branch: 'master'
          }
      }

      stage('Build Docker Image') {
          steps {
            echo 'Building Docker Imaging....'
            sh ('docker build -t $DOCKER_CREDS_USR/nodejs-todo-app:latest .' )
          }
      }

      stage('Test Image') {
          steps {
            echo 'testing image....'
            sh ('docker inspect type=image $DOCKER_CREDS_USR/nodejs-todo-app:latest')
          }
      }

      stage('Push Image to DockerHub') {
        steps {
          echo 'pushing image.....'
          sh ('docker login -u $DOCKER_CREDS_USR -p $DOCKER_CREDS_PSW')
          sh ('docker push $DOCKER_CREDS_USR/nodejs-todo-app:latest')
        }
 
      }
  }
}
